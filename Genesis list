local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TeleportService = game:GetService("TeleportService")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Create ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "GenesisFEGui"
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.Parent = playerGui

-- Detect platform (Mobile vs PC)
local isMobile = UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled

-- Set sizes based on platform
local mainFrameSize = isMobile and UDim2.new(0, 220, 0, 220) or UDim2.new(0, 280, 0, 280)
local toggleButtonSize = isMobile and UDim2.new(0, 40, 0, 40) or UDim2.new(0, 50, 0, 50)
local titleSize = isMobile and 16 or 20
local buttonTextSize = isMobile and 12 or 14
local scrollHeight = isMobile and 165 or 210
local scrollWidth = isMobile and 190 or 240
local buttonHeight = isMobile and 35 or 40

-- Toggle Button (Small draggable square)
local toggleButton = Instance.new("TextButton")
toggleButton.Name = "ToggleButton"
toggleButton.Size = toggleButtonSize
toggleButton.Position = UDim2.new(0, 20, 0.5, -25)
toggleButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
toggleButton.BackgroundTransparency = 0.3
toggleButton.BorderSizePixel = 0
toggleButton.Text = ""
toggleButton.Parent = screenGui

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 14)
toggleCorner.Parent = toggleButton

local toggleBorder = Instance.new("UIStroke")
toggleBorder.Color = Color3.fromRGB(255, 255, 255)
toggleBorder.Thickness = 1.5
toggleBorder.Transparency = 0.6
toggleBorder.Parent = toggleButton

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = mainFrameSize
mainFrame.Position = isMobile and UDim2.new(0.5, -110, 0.5, -110) or UDim2.new(0.5, -140, 0.5, -140)
mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
mainFrame.BackgroundTransparency = 0.4
mainFrame.BorderSizePixel = 0
mainFrame.Visible = false
mainFrame.Parent = screenGui

-- Rounded corners for main frame
local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 18)
mainCorner.Parent = mainFrame

-- Elegant white border
local borderFrame = Instance.new("Frame")
borderFrame.Size = UDim2.new(1, 2, 1, 2)
borderFrame.Position = UDim2.new(0, -1, 0, -1)
borderFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
borderFrame.BackgroundTransparency = 0.8
borderFrame.BorderSizePixel = 0
borderFrame.ZIndex = 0
borderFrame.Parent = mainFrame

local borderCorner = Instance.new("UICorner")
borderCorner.CornerRadius = UDim.new(0, 18)
borderCorner.Parent = borderFrame

-- Inner glow effect
local glowFrame = Instance.new("Frame")
glowFrame.Size = UDim2.new(1, -4, 1, -4)
glowFrame.Position = UDim2.new(0, 2, 0, 2)
glowFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
glowFrame.BackgroundTransparency = 0.95
glowFrame.BorderSizePixel = 0
glowFrame.ZIndex = 0
glowFrame.Parent = mainFrame

local glowCorner = Instance.new("UICorner")
glowCorner.CornerRadius = UDim.new(0, 16)
glowCorner.Parent = glowFrame

-- Title Label
local titleLabel = Instance.new("TextLabel")
titleLabel.Name = "TitleLabel"
titleLabel.Size = UDim2.new(1, 0, 0, isMobile and 40 or 45)
titleLabel.Position = UDim2.new(0, 0, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "Genesis FE Scripts"
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.TextSize = titleSize
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextTransparency = 0.1
titleLabel.Parent = mainFrame

-- Title underline
local titleLine = Instance.new("Frame")
titleLine.Size = isMobile and UDim2.new(0, 140, 0, 2) or UDim2.new(0, 180, 0, 2)
titleLine.Position = isMobile and UDim2.new(0.5, -70, 0, 38) or UDim2.new(0.5, -90, 0, 43)
titleLine.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
titleLine.BackgroundTransparency = 0.7
titleLine.BorderSizePixel = 0
titleLine.Parent = mainFrame

local lineCorner = Instance.new("UICorner")
lineCorner.CornerRadius = UDim.new(1, 0)
lineCorner.Parent = titleLine

-- Teleport Toggle Button (inside main frame - top left)
local teleportToggle = Instance.new("TextButton")
teleportToggle.Name = "TeleportToggle"
teleportToggle.Size = isMobile and UDim2.new(0, 20, 0, 20) or UDim2.new(0, 24, 0, 24)
teleportToggle.Position = isMobile and UDim2.new(0, 8, 0, 8) or UDim2.new(0, 8, 0, 8)
teleportToggle.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
teleportToggle.BackgroundTransparency = 0.5
teleportToggle.BorderSizePixel = 0
teleportToggle.Text = "T"
teleportToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
teleportToggle.TextSize = isMobile and 10 or 12
teleportToggle.Font = Enum.Font.GothamBold
teleportToggle.TextTransparency = 0.2
teleportToggle.Parent = mainFrame

local teleportCorner = Instance.new("UICorner")
teleportCorner.CornerRadius = UDim.new(0, 6)
teleportCorner.Parent = teleportToggle

local teleportBorder = Instance.new("UIStroke")
teleportBorder.Color = Color3.fromRGB(255, 255, 255)
teleportBorder.Thickness = 1
teleportBorder.Transparency = 0.7
teleportBorder.Parent = teleportToggle

-- Universal Rigs Toggle Button (inside main frame - top right)
local rigsToggle = Instance.new("TextButton")
rigsToggle.Name = "RigsToggle"
rigsToggle.Size = isMobile and UDim2.new(0, 20, 0, 20) or UDim2.new(0, 24, 0, 24)
rigsToggle.Position = isMobile and UDim2.new(1, -28, 0, 8) or UDim2.new(1, -32, 0, 8)
rigsToggle.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
rigsToggle.BackgroundTransparency = 0.5
rigsToggle.BorderSizePixel = 0
rigsToggle.Text = "R"
rigsToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
rigsToggle.TextSize = isMobile and 10 or 12
rigsToggle.Font = Enum.Font.GothamBold
rigsToggle.TextTransparency = 0.2
rigsToggle.Parent = mainFrame

local rigsCorner = Instance.new("UICorner")
rigsCorner.CornerRadius = UDim.new(0, 6)
rigsCorner.Parent = rigsToggle

local rigsBorder = Instance.new("UIStroke")
rigsBorder.Color = Color3.fromRGB(255, 255, 255)
rigsBorder.Thickness = 1
rigsBorder.Transparency = 0.7
rigsBorder.Parent = rigsToggle

-- ScrollingFrame for scripts
local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Name = "ScrollFrame"
scrollFrame.Size = UDim2.new(0, scrollWidth, 0, scrollHeight)
scrollFrame.Position = isMobile and UDim2.new(0.5, -95, 0, 45) or UDim2.new(0.5, -120, 0, 50)
scrollFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
scrollFrame.BackgroundTransparency = 0.6
scrollFrame.BorderSizePixel = 0
scrollFrame.ScrollBarThickness = isMobile and 4 or 5
scrollFrame.ScrollBarImageColor3 = Color3.fromRGB(255, 255, 255)
scrollFrame.ScrollBarImageTransparency = 0.5
scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
scrollFrame.Parent = mainFrame

local scrollCorner = Instance.new("UICorner")
scrollCorner.CornerRadius = UDim.new(0, 14)
scrollCorner.Parent = scrollFrame

local scrollBorder = Instance.new("UIStroke")
scrollBorder.Color = Color3.fromRGB(255, 255, 255)
scrollBorder.Thickness = 1
scrollBorder.Transparency = 0.8
scrollBorder.Parent = scrollFrame

local listLayout = Instance.new("UIListLayout")
listLayout.SortOrder = Enum.SortOrder.LayoutOrder
listLayout.Padding = UDim.new(0, 8)
listLayout.Parent = scrollFrame

local padding = Instance.new("UIPadding")
padding.PaddingTop = UDim.new(0, 10)
padding.PaddingBottom = UDim.new(0, 10)
padding.PaddingLeft = UDim.new(0, 10)
padding.PaddingRight = UDim.new(0, 10)
padding.Parent = scrollFrame

-- Scripts data
local scripts = {
    {name = "SIN DRAGON", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Sin%20Dragon"},
    {name = "Lightning Cannon", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Lightning%20Cannon"},
    {name = "Gale Fighter", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Gale%20Fighter"},
    {name = "Ban Hammer", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Ban%20Hammer"},
    {name = "Krystal Dance", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Krystal%20Dance"},
    {name = "Goner", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Goner"},
    {name = "Minigun", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Minigun"},
    {name = "Neptunian V", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Neptunian%20V"},
    {name = "Puppet Master", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Puppet%20Master"},
    {name = "AK-47", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/AK-47"},
    {name = "Good Cop Bad Cop", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Good%20Cop%20Bad%20Cop"},
    {name = "Studio Dummy", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Studio%20Dummy"},
    {name = "Star Glitcher", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Star%20Glitcher"},
    {name = "Pistol", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Pistol"},
    {name = "Banisher", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Banisher"},
    {name = "Karambit", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Karambit"},
    {name = "Linked Sword", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Linked%20Sword"},
    {name = "Neko", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Neko"},
    {name = "Sadist Genocider", url = "https://raw.githubusercontent.com/GenesisFE/Genesis/main/Obfuscations/Sadist%20Genocider"},
    {name = "Noli", url = "https://raw.githubusercontent.com/randomstring0/qwertys/refs/heads/main/qwerty0.lua", config = {
        ["HatCollide"] = false,
        ["ReClaim"] = true,
        ["Fling"] = true,
        ["HideCharacter"] = true,
        ["FlingOption"] = {
            ["HatFling"] = false,
            ["Highlight"] = false,
            ["PredictionFling"] = false,
            ["ToolFling"] = true
        }
    }},
    {name = "C00lkidd", url = "https://raw.githubusercontent.com/randomstring0/qwertys/refs/heads/main/qwerty2.lua", config = {
        ["HatCollide"] = false,
        ["ReClaim"] = true,
        ["Fling"] = true,
        ["HideCharacter"] = true,
        ["FlingOption"] = {
            ["HatFling"] = false,
            ["Highlight"] = true,
            ["PredictionFling"] = true,
            ["ToolFling"] = false
        }
    }}
}

-- Function to create script buttons
local function createScriptButton(scriptData, index)
    local button = Instance.new("TextButton")
    button.Name = scriptData.name
    button.Size = UDim2.new(1, -20, 0, buttonHeight)
    button.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    button.BackgroundTransparency = 0.5
    button.BorderSizePixel = 0
    button.Text = scriptData.name
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = buttonTextSize
    button.Font = Enum.Font.GothamSemibold
    button.TextTransparency = 0.15
    button.Parent = scrollFrame
   
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 12)
    btnCorner.Parent = button
   
    local btnBorder = Instance.new("UIStroke")
    btnBorder.Color = Color3.fromRGB(255, 255, 255)
    btnBorder.Thickness = 1
    btnBorder.Transparency = 0.75
    btnBorder.Parent = button
   
    button.MouseButton1Click:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.15), {BackgroundTransparency = 0.3}):Play()
        TweenService:Create(btnBorder, TweenInfo.new(0.15), {Transparency = 0.4}):Play()
        wait(0.15)
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundTransparency = 0.5}):Play()
        TweenService:Create(btnBorder, TweenInfo.new(0.2), {Transparency = 0.75}):Play()
       
        task.spawn(function()
            local success, err = pcall(function()
                if scriptData.config then
                    _G.Config = scriptData.config
                end
                local scriptCode = game:HttpGet(scriptData.url)
                local scriptFunc = loadstring(scriptCode)
                if scriptFunc then
                    scriptFunc()
                end
            end)
           
            if not success then
                warn("Failed to load " .. scriptData.name .. ": " .. tostring(err))
            end
        end)
    end)
   
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundTransparency = 0.35, TextTransparency = 0}):Play()
        TweenService:Create(btnBorder, TweenInfo.new(0.2), {Transparency = 0.5}):Play()
    end)
   
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundTransparency = 0.5, TextTransparency = 0.15}):Play()
        TweenService:Create(btnBorder, TweenInfo.new(0.2), {Transparency = 0.75}):Play()
    end)
end

-- Create all script buttons
for i, scriptData in ipairs(scripts) do
    createScriptButton(scriptData, i)
end

-- Update canvas size
scrollFrame.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + 20)
listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    scrollFrame.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y + 20)
end)

-- Blur effect for teleport confirmation
local blurEffect = Instance.new("BlurEffect")
blurEffect.Name = "TeleportBlur"
blurEffect.Size = 0
blurEffect.Parent = game:GetService("Lighting")

-- Teleport Confirmation Frame
local confirmFrame = Instance.new("Frame")
confirmFrame.Name = "ConfirmFrame"
confirmFrame.Size = isMobile and UDim2.new(0, 260, 0, 140) or UDim2.new(0, 300, 0, 160)
confirmFrame.Position = UDim2.new(0.5, isMobile and -130 or -150, 0.5, isMobile and -70 or -80)
confirmFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
confirmFrame.BackgroundTransparency = 0.3
confirmFrame.BorderSizePixel = 0
confirmFrame.Visible = false
confirmFrame.ZIndex = 100
confirmFrame.Parent = screenGui

local confirmCorner = Instance.new("UICorner")
confirmCorner.CornerRadius = UDim.new(0, 16)
confirmCorner.Parent = confirmFrame

local confirmBorder = Instance.new("UIStroke")
confirmBorder.Color = Color3.fromRGB(255, 255, 255)
confirmBorder.Thickness = 1.5
confirmBorder.Transparency = 0.6
confirmBorder.Parent = confirmFrame

-- Warning text
local warningLabel = Instance.new("TextLabel")
warningLabel.Size = UDim2.new(1, -20, 0, isMobile and 80 or 90)
warningLabel.Position = UDim2.new(0, 10, 0, isMobile and 15 or 20)
warningLabel.BackgroundTransparency = 1
warningLabel.Text = "Would You Like To Join\nGenesis Testing?"
warningLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
warningLabel.TextSize = isMobile and 14 or 16
warningLabel.Font = Enum.Font.GothamBold
warningLabel.TextWrapped = true
warningLabel.ZIndex = 101
warningLabel.Parent = confirmFrame

-- Yes button
local yesButton = Instance.new("TextButton")
yesButton.Name = "YesButton"
yesButton.Size = isMobile and UDim2.new(0, 100, 0, 32) or UDim2.new(0, 120, 0, 36)
yesButton.Position = isMobile and UDim2.new(0, 20, 1, -42) or UDim2.new(0, 20, 1, -46)
yesButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
yesButton.BackgroundTransparency = 0.4
yesButton.BorderSizePixel = 0
yesButton.Text = "YES"
yesButton.TextColor3 = Color3.fromRGB(255, 255, 255)
yesButton.TextSize = isMobile and 12 or 14
yesButton.Font = Enum.Font.GothamBold
yesButton.ZIndex = 101
yesButton.Parent = confirmFrame

local yesCorner = Instance.new("UICorner")
yesCorner.CornerRadius = UDim.new(0, 10)
yesCorner.Parent = yesButton

local yesBorder = Instance.new("UIStroke")
yesBorder.Color = Color3.fromRGB(255, 255, 255)
yesBorder.Thickness = 1
yesBorder.Transparency = 0.7
yesBorder.Parent = yesButton

-- No button
local noButton = Instance.new("TextButton")
noButton.Name = "NoButton"
noButton.Size = isMobile and UDim2.new(0, 100, 0, 32) or UDim2.new(0, 120, 0, 36)
noButton.Position = isMobile and UDim2.new(1, -120, 1, -42) or UDim2.new(1, -140, 1, -46)
noButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
noButton.BackgroundTransparency = 0.4
noButton.BorderSizePixel = 0
noButton.Text = "NO"
noButton.TextColor3 = Color3.fromRGB(255, 255, 255)
noButton.TextSize = isMobile and 12 or 14
noButton.Font = Enum.Font.GothamBold
noButton.ZIndex = 101
noButton.Parent = confirmFrame

local noCorner = Instance.new("UICorner")
noCorner.CornerRadius = UDim.new(0, 10)
noCorner.Parent = noButton

local noBorder = Instance.new("UIStroke")
noBorder.Color = Color3.fromRGB(255, 255, 255)
noBorder.Thickness = 1
noBorder.Transparency = 0.7
noBorder.Parent = noButton

-- Teleport toggle functionality
teleportToggle.MouseButton1Click:Connect(function()
    confirmFrame.Visible = true
    confirmFrame.BackgroundTransparency = 1
    warningLabel.TextTransparency = 1
    yesButton.BackgroundTransparency = 1
    yesButton.TextTransparency = 1
    noButton.BackgroundTransparency = 1
    noButton.TextTransparency = 1
    
    -- Blur screen
    TweenService:Create(blurEffect, TweenInfo.new(0.3), {Size = 20}):Play()
    
    -- Fade in dialog
    TweenService:Create(confirmFrame, TweenInfo.new(0.3), {BackgroundTransparency = 0.3}):Play()
    TweenService:Create(warningLabel, TweenInfo.new(0.3), {TextTransparency = 0}):Play()
    TweenService:Create(yesButton, TweenInfo.new(0.3), {BackgroundTransparency = 0.4, TextTransparency = 0}):Play()
    TweenService:Create(noButton, TweenInfo.new(0.3), {BackgroundTransparency = 0.4, TextTransparency = 0}):Play()
end)

-- Yes button - teleport to game
yesButton.MouseButton1Click:Connect(function()
    TweenService:Create(yesButton, TweenInfo.new(0.1), {BackgroundTransparency = 0.2}):Play()
    wait(0.1)
    
    local placeId = 78220771968979
    local success, err = pcall(function()
        TeleportService:Teleport(placeId, player)
    end)
    
    if not success then
        warn("Teleport failed: " .. tostring(err))
    end
end)

-- No button - close dialog
noButton.MouseButton1Click:Connect(function()
    TweenService:Create(noButton, TweenInfo.new(0.1), {BackgroundTransparency = 0.2}):Play()
    wait(0.1)
    
    -- Fade out dialog
    TweenService:Create(confirmFrame, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
    TweenService:Create(warningLabel, TweenInfo.new(0.2), {TextTransparency = 1}):Play()
    TweenService:Create(yesButton, TweenInfo.new(0.2), {BackgroundTransparency = 1, TextTransparency = 1}):Play()
    TweenService:Create(noButton, TweenInfo.new(0.2), {BackgroundTransparency = 1, TextTransparency = 1}):Play()
    
    -- Remove blur
    TweenService:Create(blurEffect, TweenInfo.new(0.2), {Size = 0}):Play()
    
    wait(0.2)
    confirmFrame.Visible = false
end)

-- Confirmation button hover effects
yesButton.MouseEnter:Connect(function()
    TweenService:Create(yesButton, TweenInfo.new(0.2), {BackgroundTransparency = 0.25}):Play()
    TweenService:Create(yesBorder, TweenInfo.new(0.2), {Transparency = 0.4}):Play()
end)

yesButton.MouseLeave:Connect(function()
    TweenService:Create(yesButton, TweenInfo.new(0.2), {BackgroundTransparency = 0.4}):Play()
    TweenService:Create(yesBorder, TweenInfo.new(0.2), {Transparency = 0.7}):Play()
end)

noButton.MouseEnter:Connect(function()
    TweenService:Create(noButton, TweenInfo.new(0.2), {BackgroundTransparency = 0.25}):Play()
    TweenService:Create(noBorder, TweenInfo.new(0.2), {Transparency = 0.4}):Play()
end)

noButton.MouseLeave:Connect(function()
    TweenService:Create(noButton, TweenInfo.new(0.2), {BackgroundTransparency = 0.4}):Play()
    TweenService:Create(noBorder, TweenInfo.new(0.2), {Transparency = 0.7}):Play()
end)

teleportToggle.MouseEnter:Connect(function()
    TweenService:Create(teleportToggle, TweenInfo.new(0.2), {BackgroundTransparency = 0.2}):Play()
    TweenService:Create(teleportBorder, TweenInfo.new(0.2), {Transparency = 0.4}):Play()
end)

teleportToggle.MouseLeave:Connect(function()
    TweenService:Create(teleportToggle, TweenInfo.new(0.2), {BackgroundTransparency = 0.5}):Play()
    TweenService:Create(teleportBorder, TweenInfo.new(0.2), {Transparency = 0.7}):Play()
end)

-- Universal Rigs Frame
local rigsFrame = Instance.new("Frame")
rigsFrame.Name = "RigsFrame"
rigsFrame.Size = isMobile and UDim2.new(0, 240, 0, 320) or UDim2.new(0, 280, 0, 360)
rigsFrame.Position = isMobile and UDim2.new(0.5, -120, 0.5, -160) or UDim2.new(0.5, -140, 0.5, -180)
rigsFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
rigsFrame.BackgroundTransparency = 0.4
rigsFrame.BorderSizePixel = 0
rigsFrame.Visible = false
rigsFrame.Parent = screenGui

local rigsFrameCorner = Instance.new("UICorner")
rigsFrameCorner.CornerRadius = UDim.new(0, 16)
rigsFrameCorner.Parent = rigsFrame

local rigsFrameBorder = Instance.new("UIStroke")
rigsFrameBorder.Color = Color3.fromRGB(255, 255, 255)
rigsFrameBorder.Thickness = 1.5
rigsFrameBorder.Transparency = 0.7
rigsFrameBorder.Parent = rigsFrame

-- Rigs Title
local rigsTitle = Instance.new("TextLabel")
rigsTitle.Size = UDim2.new(1, 0, 0, isMobile and 30 or 35)
rigsTitle.BackgroundTransparency = 1
rigsTitle.Text = "Universal Rigs"
rigsTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
rigsTitle.TextSize = isMobile and 13 or 15
rigsTitle.Font = Enum.Font.GothamBold
rigsTitle.TextTransparency = 0.1
rigsTitle.Parent = rigsFrame

-- Close button for rigs
local rigsClose = Instance.new("TextButton")
rigsClose.Size = isMobile and UDim2.new(0, 20, 0, 20) or UDim2.new(0, 24, 0, 24)
rigsClose.Position = isMobile and UDim2.new(1, -25, 0, 5) or UDim2.new(1, -29, 0, 5)
rigsClose.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
rigsClose.BackgroundTransparency = 0.5
rigsClose.Text = "X"
rigsClose.TextColor3 = Color3.fromRGB(255, 255, 255)
rigsClose.TextSize = isMobile and 10 or 12
rigsClose.Font = Enum.Font.GothamBold
rigsClose.BorderSizePixel = 0
rigsClose.Parent = rigsFrame

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 8)
closeCorner.Parent = rigsClose

-- Rigs ScrollFrame
local rigsScroll = Instance.new("ScrollingFrame")
rigsScroll.Size = isMobile and UDim2.new(1, -20, 1, -40) or UDim2.new(1, -20, 1, -45)
rigsScroll.Position = isMobile and UDim2.new(0, 10, 0, 35) or UDim2.new(0, 10, 0, 40)
rigsScroll.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
rigsScroll.BackgroundTransparency = 0.6
rigsScroll.BorderSizePixel = 0
rigsScroll.ScrollBarThickness = isMobile and 3 or 4
rigsScroll.ScrollBarImageColor3 = Color3.fromRGB(255, 255, 255)
rigsScroll.ScrollBarImageTransparency = 0.5
rigsScroll.Parent = rigsFrame

local rigsScrollCorner = Instance.new("UICorner")
rigsScrollCorner.CornerRadius = UDim.new(0, 12)
rigsScrollCorner.Parent = rigsScroll

local rigsLayout = Instance.new("UIListLayout")
rigsLayout.SortOrder = Enum.SortOrder.LayoutOrder
rigsLayout.Padding = UDim.new(0, 4)
rigsLayout.Parent = rigsScroll

local rigsPadding = Instance.new("UIPadding")
rigsPadding.PaddingTop = UDim.new(0, 6)
rigsPadding.PaddingBottom = UDim.new(0, 6)
rigsPadding.PaddingLeft = UDim.new(0, 6)
rigsPadding.PaddingRight = UDim.new(0, 6)
rigsPadding.Parent = rigsScroll

-- Rig items data
local rigItems = {
    {category = "BLACK RIG", items = {
        {name = "Black Classic Head", id = "14160473681"},
        {name = "Torso Extension", id = "138364679836274"},
        {name = "Black Left Arm", id = "85392395166623"},
        {name = "Black Right Arm", id = "131385506535381"},
        {name = "Black Left Leg", id = "106249329428811"},
        {name = "Black Right Leg", id = "129462518582032"}
    }},
    {category = "WHITE RIG", items = {
        {name = "Classic White Head", id = "14157139555"},
        {name = "White Torso", id = "128948172708607"},
        {name = "White Left Arm", id = "102599402682100"},
        {name = "White Right Arm", id = "82942681251131"},
        {name = "White Left Leg", id = "140395948277978"},
        {name = "White Right Leg", id = "90960046381276"}
    }},
    {category = "NOOB RIG", items = {
        {name = "Noob Head", id = "14157137406"},
        {name = "Noob Torso", id = "95290698984301"},
        {name = "Left Noob Arm", id = "84451219120140"},
        {name = "Right Noob Arm", id = "72292903231768"},
        {name = "Noob Left Leg", id = "108186273151388"},
        {name = "Noob Right Leg", id = "139904067056008"}
    }}
}

-- Track clicked items
local clickedItems = {}

-- Create rig items
for _, rigData in ipairs(rigItems) do
    local categoryLabel = Instance.new("TextLabel")
    categoryLabel.Size = UDim2.new(1, -16, 0, isMobile and 22 or 25)
    categoryLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    categoryLabel.BackgroundTransparency = 0.9
    categoryLabel.Text = rigData.category
    categoryLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    categoryLabel.TextSize = isMobile and 10 or 12
    categoryLabel.Font = Enum.Font.GothamBold
    categoryLabel.BorderSizePixel = 0
    categoryLabel.Parent = rigsScroll
    
    local catCorner = Instance.new("UICorner")
    catCorner.CornerRadius = UDim.new(0, 6)
    catCorner.Parent = categoryLabel
    
    for _, item in ipairs(rigData.items) do
        -- Container frame for image and text
        local itemFrame = Instance.new("Frame")
        itemFrame.Size = UDim2.new(1, -16, 0, isMobile and 42 or 50)
        itemFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        itemFrame.BackgroundTransparency = 0.5
        itemFrame.BorderSizePixel = 0
        itemFrame.Parent = rigsScroll
        
        local itemCorner = Instance.new("UICorner")
        itemCorner.CornerRadius = UDim.new(0, 8)
        itemCorner.Parent = itemFrame
        
        local itemBorder = Instance.new("UIStroke")
        itemBorder.Color = Color3.fromRGB(255, 255, 255)
        itemBorder.Thickness = 1
        itemBorder.Transparency = 0.8
        itemBorder.Parent = itemFrame
        
        -- Image for the hat
        local itemImage = Instance.new("ImageLabel")
        itemImage.Size = isMobile and UDim2.new(0, 34, 0, 34) or UDim2.new(0, 42, 0, 42)
        itemImage.Position = UDim2.new(0, 4, 0.5, isMobile and -17 or -21)
        itemImage.BackgroundTransparency = 1
        itemImage.Image = "rbxassetid://" .. item.id
        itemImage.ScaleType = Enum.ScaleType.Fit
        itemImage.Parent = itemFrame
        
        -- Text label for name
        local itemLabel = Instance.new("TextLabel")
        itemLabel.Size = UDim2.new(1, isMobile and -45 or -53, 1, 0)
        itemLabel.Position = isMobile and UDim2.new(0, 42, 0, 0) or UDim2.new(0, 50, 0, 0)
        itemLabel.BackgroundTransparency = 1
        itemLabel.Text = item.name
        itemLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        itemLabel.TextSize = isMobile and 8 or 10
        itemLabel.Font = Enum.Font.GothamSemibold
        itemLabel.TextXAlignment = Enum.TextXAlignment.Left
        itemLabel.TextWrapped = true
        itemLabel.Parent = itemFrame
        
        -- Invisible button overlay
        local itemButton = Instance.new("TextButton")
        itemButton.Size = UDim2.new(1, 0, 1, 0)
        itemButton.BackgroundTransparency = 1
        itemButton.Text = ""
        itemButton.Parent = itemFrame
        
        -- Click functionality
        itemButton.MouseButton1Click:Connect(function()
            -- Visual feedback
            TweenService:Create(itemFrame, TweenInfo.new(0.1), {BackgroundTransparency = 0.3}):Play()
            
            -- Mark as clicked and animate white fade in/out
            if not clickedItems[item.id] then
                clickedItems[item.id] = true
                
                -- Fade to white
                TweenService:Create(itemFrame, TweenInfo.new(0.3), {
                    BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                    BackgroundTransparency = 0.3
                }):Play()
                TweenService:Create(itemLabel, TweenInfo.new(0.3), {
                    TextColor3 = Color3.fromRGB(0, 0, 0)
                }):Play()
                
                wait(0.5)
                
                -- Fade back to original
                TweenService:Create(itemFrame, TweenInfo.new(0.4), {
                    BackgroundColor3 = Color3.fromRGB(0, 0, 0),
                    BackgroundTransparency = 0.5
                }):Play()
                TweenService:Create(itemLabel, TweenInfo.new(0.4), {
                    TextColor3 = Color3.fromRGB(255, 255, 255)
                }):Play()
            else
                -- If already clicked, do a quick flash
                TweenService:Create(itemFrame, TweenInfo.new(0.15), {
                    BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                    BackgroundTransparency = 0.2
                }):Play()
                TweenService:Create(itemLabel, TweenInfo.new(0.15), {
                    TextColor3 = Color3.fromRGB(0, 0, 0)
                }):Play()
                
                wait(0.3)
                
                TweenService:Create(itemFrame, TweenInfo.new(0.3), {
                    BackgroundColor3 = Color3.fromRGB(0, 0, 0),
                    BackgroundTransparency = 0.5
                }):Play()
                TweenService:Create(itemLabel, TweenInfo.new(0.3), {
                    TextColor3 = Color3.fromRGB(255, 255, 255)
                }):Play()
            end
            
            wait(0.1)
            TweenService:Create(itemFrame, TweenInfo.new(0.1), {BackgroundTransparency = 0.5}):Play()
            
            -- Copy full ID to clipboard
            local fullId = "https://www.roblox.com/catalog/" .. item.id
            setclipboard(fullId)
            
            -- Show copied notification
            local originalText = itemLabel.Text
            itemLabel.Text = item.name .. " (Copied!)"
            wait(1.5)
            itemLabel.Text = originalText
        end)
        
        itemButton.MouseEnter:Connect(function()
            TweenService:Create(itemFrame, TweenInfo.new(0.2), {BackgroundTransparency = 0.35}):Play()
            TweenService:Create(itemBorder, TweenInfo.new(0.2), {Transparency = 0.5}):Play()
        end)
        
        itemButton.MouseLeave:Connect(function()
            TweenService:Create(itemFrame, TweenInfo.new(0.2), {BackgroundTransparency = 0.5}):Play()
            TweenService:Create(itemBorder, TweenInfo.new(0.2), {Transparency = 0.8}):Play()
        end)
    end
end

rigsScroll.CanvasSize = UDim2.new(0, 0, 0, rigsLayout.AbsoluteContentSize.Y + 16)
rigsLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    rigsScroll.CanvasSize = UDim2.new(0, 0, 0, rigsLayout.AbsoluteContentSize.Y + 16)
end)

-- Rigs toggle functionality
local rigsOpen = false
rigsToggle.MouseButton1Click:Connect(function()
    rigsOpen = not rigsOpen
    rigsFrame.Visible = rigsOpen
    
    if rigsOpen then
        rigsFrame.BackgroundTransparency = 1
        rigsTitle.TextTransparency = 1
        rigsScroll.BackgroundTransparency = 1
        rigsClose.BackgroundTransparency = 1
        
        TweenService:Create(rigsFrame, TweenInfo.new(0.3), {BackgroundTransparency = 0.4}):Play()
        TweenService:Create(rigsTitle, TweenInfo.new(0.3), {TextTransparency = 0.1}):Play()
        TweenService:Create(rigsScroll, TweenInfo.new(0.3), {BackgroundTransparency = 0.6}):Play()
        TweenService:Create(rigsClose, TweenInfo.new(0.3), {BackgroundTransparency = 0.5}):Play()
        
        -- Rotate button when opening
        TweenService:Create(rigsToggle, TweenInfo.new(0.3), {
            Rotation = 90,
            BackgroundTransparency = 0.3
        }):Play()
    else
        TweenService:Create(rigsFrame, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
        TweenService:Create(rigsTitle, TweenInfo.new(0.2), {TextTransparency = 1}):Play()
        TweenService:Create(rigsScroll, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
        TweenService:Create(rigsClose, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
        
        -- Rotate button back when closing
        TweenService:Create(rigsToggle, TweenInfo.new(0.3), {
            Rotation = 0,
            BackgroundTransparency = 0.5
        }):Play()
        
        wait(0.2)
        rigsFrame.Visible = false
    end
end)

rigsClose.MouseButton1Click:Connect(function()
    rigsOpen = false
    TweenService:Create(rigsFrame, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
    TweenService:Create(rigsTitle, TweenInfo.new(0.2), {TextTransparency = 1}):Play()
    TweenService:Create(rigsScroll, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
    TweenService:Create(rigsClose, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
    
    -- Rotate button back when closing via X button
    TweenService:Create(rigsToggle, TweenInfo.new(0.3), {
        Rotation = 0,
        BackgroundTransparency = 0.5
    }):Play()
    
    wait(0.2)
    rigsFrame.Visible = false
end)

rigsToggle.MouseEnter:Connect(function()
    TweenService:Create(rigsToggle, TweenInfo.new(0.2), {BackgroundTransparency = 0.2}):Play()
    TweenService:Create(rigsBorder, TweenInfo.new(0.2), {Transparency = 0.4}):Play()
end)

rigsToggle.MouseLeave:Connect(function()
    if rigsOpen then
        TweenService:Create(rigsToggle, TweenInfo.new(0.2), {BackgroundTransparency = 0.3}):Play()
    else
        TweenService:Create(rigsToggle, TweenInfo.new(0.2), {BackgroundTransparency = 0.5}):Play()
    end
    TweenService:Create(rigsBorder, TweenInfo.new(0.2), {Transparency = 0.7}):Play()
end)

rigsClose.MouseEnter:Connect(function()
    TweenService:Create(rigsClose, TweenInfo.new(0.2), {BackgroundTransparency = 0.3}):Play()
end)

rigsClose.MouseLeave:Connect(function()
    TweenService:Create(rigsClose, TweenInfo.new(0.2), {BackgroundTransparency = 0.5}):Play()
end)

-- Dragging functionality for rigs frame
local draggingRigs = false
local dragInputRigs, mousePosRigs, framePosRigs
local dragTweenRigs

local function updateRigs(input)
    if dragTweenRigs then
        dragTweenRigs:Cancel()
    end
   
    local delta = input.Position - mousePosRigs
    local targetPos = UDim2.new(
        framePosRigs.X.Scale,
        framePosRigs.X.Offset + delta.X,
        framePosRigs.Y.Scale,
        framePosRigs.Y.Offset + delta.Y
    )
   
    dragTweenRigs = TweenService:Create(rigsFrame, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Position = targetPos
    })
    dragTweenRigs:Play()
end

rigsFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        draggingRigs = true
        mousePosRigs = input.Position
        framePosRigs = rigsFrame.Position
       
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                draggingRigs = false
            end
        end)
    end
end)

rigsFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInputRigs = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInputRigs and draggingRigs then
        updateRigs(input)
    end
end)

-- Main frame toggle functionality
local isOpen = false
toggleButton.MouseButton1Click:Connect(function()
    isOpen = not isOpen
   
    if isOpen then
        mainFrame.Visible = true
        mainFrame.BackgroundTransparency = 1
        titleLabel.TextTransparency = 1
        scrollFrame.BackgroundTransparency = 1
        borderFrame.BackgroundTransparency = 1
        glowFrame.BackgroundTransparency = 1
        titleLine.BackgroundTransparency = 1
       
        for _, button in ipairs(scrollFrame:GetChildren()) do
            if button:IsA("TextButton") then
                button.BackgroundTransparency = 1
                button.TextTransparency = 1
            end
        end
       
        TweenService:Create(mainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            BackgroundTransparency = 0.4
        }):Play()
       
        TweenService:Create(borderFrame, TweenInfo.new(0.4), {
            BackgroundTransparency = 0.8
        }):Play()
       
        TweenService:Create(glowFrame, TweenInfo.new(0.4), {
            BackgroundTransparency = 0.95
        }):Play()
       
        TweenService:Create(titleLabel, TweenInfo.new(0.4), {
            TextTransparency = 0.1
        }):Play()
       
        TweenService:Create(titleLine, TweenInfo.new(0.4), {
            BackgroundTransparency = 0.7
        }):Play()
       
        TweenService:Create(scrollFrame, TweenInfo.new(0.4), {
            BackgroundTransparency = 0.6
        }):Play()
       
        for _, button in ipairs(scrollFrame:GetChildren()) do
            if button:IsA("TextButton") then
                TweenService:Create(button, TweenInfo.new(0.4), {
                    BackgroundTransparency = 0.5,
                    TextTransparency = 0.15
                }):Play()
            end
        end
       
        TweenService:Create(toggleButton, TweenInfo.new(0.3), {
            BackgroundTransparency = 0.5,
            Rotation = 90
        }):Play()
    else
        TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
            BackgroundTransparency = 1
        }):Play()
       
        TweenService:Create(borderFrame, TweenInfo.new(0.3), {
            BackgroundTransparency = 1
        }):Play()
       
        TweenService:Create(glowFrame, TweenInfo.new(0.3), {
            BackgroundTransparency = 1
        }):Play()
       
        TweenService:Create(titleLabel, TweenInfo.new(0.3), {
            TextTransparency = 1
        }):Play()
       
        TweenService:Create(titleLine, TweenInfo.new(0.3), {
            BackgroundTransparency = 1
        }):Play()
       
        TweenService:Create(scrollFrame, TweenInfo.new(0.3), {
            BackgroundTransparency = 1
        }):Play()
       
        for _, button in ipairs(scrollFrame:GetChildren()) do
            if button:IsA("TextButton") then
                TweenService:Create(button, TweenInfo.new(0.3), {
                    BackgroundTransparency = 1,
                    TextTransparency = 1
                }):Play()
            end
        end
       
        TweenService:Create(toggleButton, TweenInfo.new(0.3), {
            BackgroundTransparency = 0.3,
            Rotation = 0
        }):Play()
       
        wait(0.3)
        mainFrame.Visible = false
    end
end)

toggleButton.MouseEnter:Connect(function()
    TweenService:Create(toggleButton, TweenInfo.new(0.2), {
        BackgroundTransparency = 0.2
    }):Play()
    TweenService:Create(toggleBorder, TweenInfo.new(0.2), {
        Transparency = 0.3
    }):Play()
end)

toggleButton.MouseLeave:Connect(function()
    if isOpen then
        TweenService:Create(toggleButton, TweenInfo.new(0.2), {
            BackgroundTransparency = 0.5
        }):Play()
    else
        TweenService:Create(toggleButton, TweenInfo.new(0.2), {
            BackgroundTransparency = 0.3
        }):Play()
    end
    TweenService:Create(toggleBorder, TweenInfo.new(0.2), {
        Transparency = 0.6
    }):Play()
end)

-- Dragging functionality for toggle button
local draggingToggle = false
local dragInputToggle, mousePosToggle, framePosToggle
local dragTweenToggle

local function updateToggle(input)
    if dragTweenToggle then
        dragTweenToggle:Cancel()
    end
   
    local delta = input.Position - mousePosToggle
    local targetPos = UDim2.new(
        framePosToggle.X.Scale,
        framePosToggle.X.Offset + delta.X,
        framePosToggle.Y.Scale,
        framePosToggle.Y.Offset + delta.Y
    )
   
    dragTweenToggle = TweenService:Create(toggleButton, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Position = targetPos
    })
    dragTweenToggle:Play()
end

toggleButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        draggingToggle = true
        mousePosToggle = input.Position
        framePosToggle = toggleButton.Position
       
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                draggingToggle = false
            end
        end)
    end
end)

toggleButton.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInputToggle = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInputToggle and draggingToggle then
        updateToggle(input)
    end
end)

-- Dragging functionality for main frame
local draggingMain = false
local dragInputMain, mousePosMain, framePosMain
local dragTweenMain

local function updateMain(input)
    if dragTweenMain then
        dragTweenMain:Cancel()
    end
   
    local delta = input.Position - mousePosMain
    local targetPos = UDim2.new(
        framePosMain.X.Scale,
        framePosMain.X.Offset + delta.X,
        framePosMain.Y.Scale,
        framePosMain.Y.Offset + delta.Y
    )
   
    dragTweenMain = TweenService:Create(mainFrame, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Position = targetPos
    })
    dragTweenMain:Play()
end

mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        draggingMain = true
        mousePosMain = input.Position
        framePosMain = mainFrame.Position
       
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                draggingMain = false
            end
        end)
    end
end)

mainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInputMain = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInputMain and draggingMain then
        updateMain(input)
    end
end)

-- Startup animation
toggleButton.Position = UDim2.new(0, -100, 0.5, -25)
TweenService:Create(toggleButton, TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
    Position = UDim2.new(0, 20, 0.5, -25)
}):Play()

print("Genesis FE Scripts GUI loaded successfully!")
